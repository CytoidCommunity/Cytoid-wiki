# Cytoid 游戏机制

!> Author: 冰糖酱-BillZhou233

这里将会介绍关于 Cytoid 游戏机制的进阶内容. 

## 判定 & Rating

在 Cytoid 社区讨论中, 您或许会经常听到“R 判”或者“Ranked”这类术语, 它们是 1.x 版本时对现版本默认判定模式的一种称呼. 相对地, 之前版本的默认判定模式（U 判 / Unranked）在 2.0 版本中被称为 __练习模式__ ~~dd 模式~~. 为了方便起见, 下文中我们将沿用 U 判 / R 判的称呼. 

> 相关源码
> 
> [Assets/Scripts/Game/Notes/Note.cs](https://github.com/Cytoid/Cytoid/blob/main/Assets/Scripts/Game/Notes/Note.cs)
> 
> [Assets/Scripts/Game/NoteGrade.cs](https://github.com/Cytoid/Cytoid/blob/main/Assets/Scripts/Game/NoteGrade.cs)
> 
> [Assets/Scripts/Game/GameState.cs](https://github.com/Cytoid/Cytoid/blob/main/Assets/Scripts/Game/GameState.cs)


### 判定区间

U 判和 R 判的游戏玩法完全相同, 区别只在于 __判定区间和计分方式__. 

两种判定模式的具体判定区间参阅下表（单位：ms, 越正越迟, 反之越早）：

|判定模式|Perfect（蓝）|Great（黄）|Good（绿）|Bad（红）|Miss（灰）|
|:---:|:---:|:---:|:---:|:---:|:---:|
|Unranked|±70|-200 / +150|-400 / +200|-800 / +300|X|
|Ranked|±40|±70|-200 / +150|-400 / +200|X|

当然, 一般情况下, 您只需要记住：__R 判下的所有判定区间都比 U 判严格一个等级__ 就可以啦！

### 分数

分数表示着玩家在游玩中的粗略表现（含连击表现）. 无论采用何种判定模式, 满分均为 1,000,000 分（即 All Perfect MAX）, 其余评价级别对应的分数段如下表：

|评级|MAX|SSS|SS|S|AA|A|B|C|D|F|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|分数段|1,000,000|999,000+|995,000+|990,000+|950,000+|900,000+|800,000+|700,000+|600,000+|600,000-|

#### Unranked

U 判的计分方式包括 900,000 分的判定分和 100,000 分的连击分. 结算时两部分得分四舍五入至整数后相加. 

判定分 __平均分配__ 给每个 Note, 清除 Note 时根据判定结果获得该 Note 的判定分百分比按下表计算：

|判定结果|Perfect / Great|Good|Bad|Miss|
|:---:|:---:|:---:|:---:|:---:|
|判定分 %|100%|70%|30%|0%|

连击分按照当前连击数以 __等差数列__ 的方式进行叠加, 设谱面物量（即 Note 总数）为 N, 则每一小份连击分为 (N * (N + 1) / 2), 清除每个 Note 时若当前连击数为 C 则将 C 小份连击分叠加到总分上, 若断连则 C 归零. 

#### Ranked

R 判的计分方式使用一种特殊算法, 总的来说, 这种算法与连击数 __也存在关联__, 但这一关联比 U 判更弱. 

不过, 要将这个算法完整地解说出来的话, 各位玩家可能难以理解, 所以在解说时能跳过这一部分吗？

> Sayaka：不可以啦！

那么, 下面就进行较为完整地解说. <!--这东西真的好难写啊！！1111-->

R 判将 1,000,000 分的满分 __平均分配__ 给每个 Note 作为各自的 __基准分__, 清除 Note 时根据判定结果获得该 Note 的基准分百分比按下表计算：

|判定结果|Perfect|Great|Good|Bad|Miss|
|:---:|:---:|:---:|:---:|:---:|:---:|
|基准分 %|100%|90% ~ 99.99%|50%|10%|0%|

其中, Great 判定的基准分比较特别, 它并非简单的固定百分比, 而是和相对打击偏差成 __线性相关__, 打击偏差越大, 获得的基准分越少. 

决定每个 Note 的得分还有另一个关键值, 在此暂且称它为得分系数. 它的取值在 0 ~ 1 之间, 初始值为 1, 每个 Note 判定后根据结果对其作出以下改动：

|判定结果|Perfect|Great|Good|Bad|Miss|
|:---:|:---:|:---:|:---:|:---:|:---:|
|变化量|+0.004C|+0.002C|+0.001C|-0.025C|-0.05C|

其中, C 为一个常数, 它的值为（该谱面物量的算术平方根 / 3）. 

基准分和得分系数计算完毕后, 将两部分相乘, 再叠加到总分上. 

结算时, 由于计分系统可能存在的精度问题, 对最终的分数再做出如下补正：
- 分数计算值大于 1,000,000 按 1,000,000 计. 
- 分数计算值大于 995,000 且 AP 按 1,000,000 计. 
- 分数计算值为 1,000,000 但未 AP 按 999,999 计. 

### 精准度

精准度代表着玩家在游戏中更加精细的准确度情况, 采用百分比表示. 无论采用何种判定模式, 最高值均为 100%（即完美精准度 / 收歌 / 杀歌 / ~~MGA TANGA!!~~）, 显示时保留两位小数. 

#### Unranked

U 判中, 清除 Note 时根据判定结果获得的该 Note 的精准度按下表计算：

|判定结果|Perfect|Great|Good|Bad / Miss|
|:---:|:---:|:---:|:---:|:---:|
|精准度|100%|70%|30%|0%|

总体的精准度计算方式为每个 Note 的精准度 __取平均值__. 

#### Ranked

R 判清除 Note 时的精准度计算方法和 U 判基本一致, 如下表：

|判定结果|Perfect|Great|Good|Bad / Miss|
|:---:|:---:|:---:|:---:|:---:|
|精准度|100%|70% ~ 99.99%|30%|0%|

同样, Great 判定获得的精准度也和相对打击偏差成 __线性相关__, 打击偏差越大, 获得的精准度越少. 

总体的精准度计算同样为每个 Note 的精准度 __取平均值__. 

### Rating

!> 本段部分摘录自官方说明[《Rating 和你》](https://www.bilibili.com/read/cv6536670)以及 [Notion](https://www.notion.so/Rating-System-509becb063954a699d1be1fc82eecd70) 上的解说. 

Rating（rt）是用于展现玩家实力的数值. Cytoid 有一套详细的算法来为每位玩家评估他们的实力, 此处对它的完整解说可能略微复杂, 如果不太理解, 您也可以去游戏中的训练模式询问 Kaede. 

每次使用 R 判游玩一张谱面并提交成功后, 游戏会计算一份 __单曲 Rating__, 并记录在您的档案库中, 用于计算您的 __整体 Rating__. 

它们的计算方法如下：

> 单曲 Rating = 表现评分（与精准度有关） * 谱面等级
>
> 整体 Rating =（最高的 30 个单曲 Rating + 最近 60 天中最高的 10 个单曲 Rating）/ 40
> 
> 表现评分 y 的计算按照与精准度 x 有关的如下分段函数：  
> ![](/_source_mechanism.md/rt_latex.svg)  
> 不想看到这么复杂的函数式？画成图像大概长这样：  
> ![](/_source_mechanism.md/rt_graph.png)  

<!--
LaTeX Source:
y=
\begin{cases}
 & 0.5\sqrt{\frac{x}{70}} \text{, } 0 < x < 70 \\
 & 0.7-0.2\log_{10}{(\frac{100-x}{3})} \text{, } 70 \leqslant x < 97 \\ 
 & 0.7-0.16\log_{10}{(\frac{100-x}{3})} \text{, } 97 \leqslant x < 99.7 \\ 
 & 0.78-0.08\log_{10}{(\frac{100-x}{3})} \text{, } 99.7 \leqslant x < 99.97 \\ 
 & 2x-199 \text{, } 99.97 \leqslant x < 100 
\end{cases}
Thanks to https://www.codecogs.com/latex/eqneditor.php
-->

以下是该套计算公式的补充说明：

- ？难度的谱面不参与 Rating 计算. 
- 对于同一谱面 ID, 不同难度的单曲 Rating 分别计算. 
- 谱面等级的取值为 1 ~ 16, 对应谱面的难度等级（16 对应 15+）. 因此, 单曲和整体 Rating 的最大值均为 16. 
- 用于计算“最高的 30 个单曲 Rating”的谱面 ID（同一难度）__不可重复__. 
- 用于计算“最近 60 天中最高的 10 个单曲 Rating”的谱面 ID（同一难度）__可以重复__. <!-- 原文中为不可重复, 但是在推歌之后查分发现是可以重复的, 就以实际情况为准了 -->
- 在计算整体 Rating 时, “最近 60 天中最高的 10 个单曲 Rating”会进行 __浮动改动__. 
  - 在距离结算时间的 0 ~ 30 天内, 它不会有任何改变. 
  - 在随后的 30 ~ 60 天内, 它会额外乘以一个线性参数, 从 1 逐渐降为 0. 
  - 这意味着, 如果您超过一个月没有进行任何游玩, 你的 Rating 就会开始持续下降, 直到上述公式中的“最近 60 天中最高的 10 个单曲 Rating”归零为止. 
  - 同时, 只要你在一个月内保持活跃（10 次游玩以上）, 你的 Rating 就 __不会下降__. 所以, 记得常来 Cytoid 玩！

想要了解自己的 Rating 是如何计算的？请登入 Cytoid 官网, 进入 __工作室 > Cytoid 分析__ 页面, 即可查看您的 Rating 计算明细. 

## Mods

和很多自制类音游一样, Cytoid 也提供了各种各样的 Mods 来拓展游戏体验, 接下来的部分将分类介绍它们（顺序可能与游戏内不同）. 

### 自动预览类

!> 该类 Mods 启用时, 歌曲结束后将不会显示谱面结算画面而直接返回选曲后的准备界面. 

启用 Auto 后将进入自动预览模式, 该模式下游戏会自动清除 Note, 便于看谱以及录制谱面预览. 若 Auto 后注明了 Note 种类, 启用后则只会自动清除对应种类的 Note, 限定种类的 Auto 可以叠加使用. 

### 速度类

- Fast：启用后 Note __更迟__ 出现且出现时动画速度 __加快__. 在 Storyboard 指定为下落式方式时加快下落速率. 
- Slow：启用后 Note __更早__ 出现且出现时动画速度 __减慢__. 在 Storyboard 指定为下落式方式时减慢下落速率. 

以上两个 Mods 不能叠加使用, 大部分玩家偏向于使用 Fast. 除此之外, 高级设置中的 __实验性 Note AR__ 由于能够使 Note 在刚出现时更小, 也有使 Note 更早出现的副作用. 想要了解实验性 Note AR 与 Fast 对速度的相互作用？请参看 [这个视频](https://www.bilibili.com/video/BV1ua4y1a7qT). 

### 镜像类

- Flip X：谱面左右镜像翻转. 
- Flip Y：谱面上下镜像翻转. 
- Flip All：谱面旋转 180 度 ~~倒打~~. 

不能叠加使用 ~~但是可以通过旋转设备的方式叠加 Flip All 和其他两者~~. 

### 隐藏类

- No Scanner：隐藏判定线. 
- Invisible：隐藏 Note. 

可以叠加使用. 

### 血条类

相当于 Dynamix 的 Bleed 模式, 将会在基本游戏规则之外追加一个血量计, 归零时即为游玩失败 ~~你美丽 jajaja~~. 

Another 下的血量计比 Hyper 更加严格, 两者的具体规则如下：

|模式|起始血量|Perfect|Great|Good|Bad|Miss|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|Hyper|75 * 难度|+2 HP|-1%|-3%|-6%|-8%|
|Another|75 * 难度|+2 HP|-4%|-8%|-15%|-20%|

请注意：Perfect 回血是 __按数值增加__ 而其他判定则是 __按百分比减少__. 

### Sudden Death 类

- FC：不全连, 便重开（断连即结束）. 
- AP：不杀歌, 便重开（打出非 Perfect 即结束）. 

不能叠加使用. 

## 改变设定

!> 这里的设定选项参考 iOS 2.0.0 正式版, 有些选项已在游戏中给出比较清楚的备注, 此处不再解说. 

### 阿：基本设定 

- CDN 地区：中国大陆对应 [cytoid.cn](//cytoid.cn), 国际对应 [cytoid.io](//cytoid.io). 
- 完成后跳过音乐：开启时游戏会在最后一个 Note 判定结束之后 __立刻结算__, 否则会等待音频播放结束再进行结算. 
- 全局偏移相关：参见 [开始游戏](/gameplay/how_to_play) 中关于偏移校正的解说. 

### 格：游玩设定

- Early / Late 指示器：开启后游玩时将会显示非 Perfect 判定的击中快慢, 结算画面中除 Early / Late 计数外还会显示 ATE（平均判定误差）和 STE（标准判定误差）. 
- 判定区域调节：越大则 Note 越容易被击中, 但也更容易造成挨得太近的多个 Note 由于感应区重叠而无法全部被感应到的情况. 
- 边距调节：越正越窄, 反之越宽. 

### 王：显示设定

!> Storyboard 中有能够改变显示设定的指令, 利用这些指令, 谱师可直接指定谱面中的显示设定. 但 Storyboard 改变的设定只在对应的谱面中生效, 不会应用到全局. 

- 游玩区域边界：开启后将会出现指示上下边界的虚线. 
- 背景不透明度：0% 为全黑, 越大则背景越亮. 
- Drag / C-Drag 使用内圆颜色：关闭后将会以类似旧版本 Cytoid 1.x 的配色方案来填充子锁链 Note（即中间节点）的颜色. 

### 朔：高级设定

- 分析器：位于屏幕右下角的帧率指示器. 
- Note ID：在 Note 上显示数字编号, 便于谱面制作和交流时确定 Note. 
- 开发者控制台：控制是否显示屏幕底部的报错信息. 
- 实验性 Note AR：使 Note 更早出现且刚出现时更小, 常搭配 Fast 使用. 
- 判定时间调整：判定时先将该值叠加在打击偏差上再计算结果. 
- APPLY LATEST LOCALIZATION：使用最新的本地化文本, 需要一定时间激活且 __重启游戏后将失效__. 
